{% extends '@EndroidFinance/base.html.twig' %}

{% block title %}Finance - {{ parent() }}{% endblock %}

{% block content %}

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js" type="text/javascript"></script>

    <h1>Finance</h1>

    {% for monthLabel, month in transactions %}

        <h2>{{ monthLabel }}</h2>

        {% if category.monthTotals|length > 1 %}

            <canvas id="category_{{ loop.index }}"></canvas>
            <script>
                var category_{{ loop.index }}_data = {
                    labels : [{{ category.monthLabels|reverse|join(",") }}],
                    datasets : [
                        {
                            fillColor : "rgba(172,194,255,0.4)",
                            strokeColor : "#ACC29D",
                            pointColor : "#fff",
                            pointStrokeColor : "#9DB89D",
                            data : [{{ category.monthTotals|reverse|join(",") }}]
                        }
                    ]
                };
                var category_{{ loop.index }} = document.getElementById('category_{{ loop.index }}').getContext('2d');
                new Chart(category_{{ loop.index }}).Line(category_{{ loop.index }}_data);
            </script>
            <br /><br />

        {% endif %}

        <table class="table table-striped invoice-table">
            <tbody>
                {% for monthLabel, month in category.months %}
                    <tr>
                        <td width="80px">{{ monthLabel }}</td>
                        <td>
                            <a href="#" onclick="$('#transactions_{{ loop.index }}_{{ loop.parent.loop.index }}').toggle(); return false;">Details</a>
                            <table id="transactions_{{ loop.index }}_{{ loop.parent.loop.index }}" style="display: none; font-size: 9px;">
                                {% for transaction in month.transactions %}
                                    <tr>
                                        <td>{{ transaction[0] }}</td>
                                        <td>{{ transaction[8] }}</td>
                                        <td>{{ transaction[5] }}</td>
                                        <td align="right">{{ transaction[6] }}</td>
                                    </tr>
                                {% endfor %}
                            </table>
                        </td>
                        <td width="80px" align="right">{{ month.total|number_format(2, '.', ',') }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <br />

    {% endfor %}

    <form action="{{ path('endroid_play_budget_index') }}" method="post" enctype="multipart/form-data">
        <p>
            <label for="file">Select a file</label> <input type="file" name="file" id="file"> <br />
            <button>Upload File</button>
        <p>
    </form>

{% endblock %}
